# Auto-Inventory Bot

**Zero-Manual-Work Infrastructure Documentation for Kubernetes**

This bot automatically scans your Kubernetes cluster daily and generates Obsidian-compatible Markdown documentation with YAML frontmatter.

## ğŸ¯ Purpose

Maintain always-up-to-date infrastructure documentation by scanning:
- **Hardware Nodes** - Physical servers with specs, IPs, and status
- **Applications** - Apps exposed via Ingress with URLs and host mapping

## ğŸ—ï¸ Architecture

- **Deployment:** GitOps via ArgoCD (Application #41)
- **CI/CD:** Woodpecker pipeline (automatic builds)
- **Execution Node:** `prod3` (resource-optimized placement)
- **Schedule:** Daily at 2:00 AM UTC
- **Output:** Git repository with Obsidian-compatible Markdown files
- **Philosophy:** "The documentation writes itself"

## ğŸ“ Project Structure

```
infra-doc/
â”œâ”€â”€ inventory.py          # Main scanning logic
â”œâ”€â”€ requirements.txt      # Python dependencies
â”œâ”€â”€ Dockerfile           # Container image definition
â”œâ”€â”€ .woodpecker.yml      # CI/CD pipeline configuration
â”œâ”€â”€ DEPLOYMENT.md        # Complete deployment guide
â”œâ”€â”€ deploy/
â”‚   â””â”€â”€ cronjob.yaml     # Kubernetes deployment manifest
â””â”€â”€ gitops/              # GitOps-ready manifests
    â”œâ”€â”€ README.md        # GitOps setup instructions
    â”œâ”€â”€ 00-namespace.yaml
    â”œâ”€â”€ 01-rbac.yaml
    â”œâ”€â”€ 02-configmap.yaml
    â””â”€â”€ 03-cronjob.yaml
```

## ğŸš€ Quick Start (The DevOps Way)

**Read this first:** This is NOT deployed manually. It follows the "Zero Manual Work" philosophy.

ğŸ‘‰ **See [DEPLOYMENT.md](DEPLOYMENT.md) for the complete DevOps deployment guide.**

### TL;DR - 3 Steps

1. **Push to Gitea** â†’ Enables Woodpecker CI/CD
2. **Copy `gitops/` manifests to k8s-gitops repo** â†’ ArgoCD deploys automatically
3. **Create git-credentials secret** â†’ The ONLY manual command needed

```bash
# The ONLY manual command you'll ever run:
kubectl create secret generic git-credentials \
  --from-literal=username=gitea-admin \
  --from-literal=password=YOUR_GITEA_TOKEN \
  --from-literal=repo_url=gitea-http.gitea.svc.cluster.local:3000/gitea-admin/infrastructure-docs.git \
  -n infrastructure-docs
```

**After that, everything is automated:**
- Code changes â†’ Woodpecker builds â†’ GitOps updates â†’ ArgoCD deploys
- Bot runs daily â†’ Scans infrastructure â†’ Commits docs â†’ Forever

## ğŸ“Š Output Format

### Hardware Documentation

```yaml
---
type: hardware
hostname: prod3
ip: 172.16.16.163
status: Ready
cpu_cores: "8"
memory: 16Gi
os: Ubuntu 22.04.3 LTS
kernel: 5.15.0-91-generic
updated: 2025-12-05 02:00:00 UTC
---

# prod3
...
```

### Application Documentation

```yaml
---
type: application
name: grafana
namespace: monitoring
url: grafana.yourdomain.com
hosted_on: prod3
updated: 2025-12-05 02:00:00 UTC
---

# grafana

**Application deployed in namespace:** `monitoring`

## Access
**Primary URL:** [grafana.yourdomain.com](https://grafana.yourdomain.com)

## Infrastructure
- **Namespace:** `monitoring`
- **Hosted On:** [[prod3]]
...
```

## ğŸ” Security

- Uses Kubernetes RBAC with read-only access
- ServiceAccount with minimal required permissions
- Git credentials stored in Kubernetes Secrets

## ğŸ› ï¸ RBAC Permissions

The bot requires read access to:
- `nodes` (cluster-wide)
- `pods` (cluster-wide)
- `services` (cluster-wide)
- `ingresses` (cluster-wide)

## ğŸ“ License

MIT

## ğŸ‘¤ Author

Auto-generated by Claude Code for GMK Infrastructure
# Trigger build
# Trigger build
