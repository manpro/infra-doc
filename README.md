# Auto-Inventory Bot

**Zero-Manual-Work Infrastructure Documentation for Kubernetes**

This bot automatically scans your Kubernetes cluster daily and generates Obsidian-compatible Markdown documentation with YAML frontmatter.

## ğŸ¯ Purpose

Maintain always-up-to-date infrastructure documentation by scanning:
- **Hardware Nodes** - Physical servers with specs, IPs, and status
- **Applications** - Apps exposed via Ingress with URLs and host mapping

## ğŸ—ï¸ Architecture

- **Execution Node:** `prod3` (resource-optimized placement)
- **Schedule:** Daily at 2:00 AM UTC
- **Output:** Git repository with Obsidian-compatible Markdown files
- **Philosophy:** "The documentation writes itself"

## ğŸ“ Project Structure

```
infra-doc/
â”œâ”€â”€ inventory.py          # Main scanning logic
â”œâ”€â”€ requirements.txt      # Python dependencies
â”œâ”€â”€ Dockerfile           # Container image definition
â””â”€â”€ deploy/
    â””â”€â”€ cronjob.yaml     # Kubernetes deployment manifest
```

## ğŸš€ Quick Start

### 1. Build and Push Docker Image

```bash
docker build -t your-registry/auto-inventory-bot:latest .
docker push your-registry/auto-inventory-bot:latest
```

### 2. Create Git Credentials Secret

```bash
kubectl create secret generic git-credentials \
  --from-literal=username=your-gitea-user \
  --from-literal=password=your-gitea-token \
  --from-literal=repo_url=gitea.yourdomain.com/username/infrastructure-docs.git \
  -n infrastructure-docs
```

### 3. Update Image Reference

Edit `deploy/cronjob.yaml` and replace `your-registry/auto-inventory-bot:latest` with your actual image location.

### 4. Deploy to Kubernetes

```bash
kubectl apply -f deploy/cronjob.yaml
```

### 5. Test Immediately (Optional)

```bash
kubectl create job --from=cronjob/auto-inventory-bot manual-test-1 -n infrastructure-docs
kubectl logs -f job/manual-test-1 -n infrastructure-docs
```

## ğŸ“Š Output Format

### Hardware Documentation

```yaml
---
type: hardware
hostname: prod3
ip: 172.16.16.163
status: Ready
cpu_cores: "8"
memory: 16Gi
os: Ubuntu 22.04.3 LTS
kernel: 5.15.0-91-generic
updated: 2025-12-05 02:00:00 UTC
---

# prod3
...
```

### Application Documentation

```yaml
---
type: application
name: grafana
namespace: monitoring
url: grafana.yourdomain.com
hosted_on: prod3
updated: 2025-12-05 02:00:00 UTC
---

# grafana

**Application deployed in namespace:** `monitoring`

## Access
**Primary URL:** [grafana.yourdomain.com](https://grafana.yourdomain.com)

## Infrastructure
- **Namespace:** `monitoring`
- **Hosted On:** [[prod3]]
...
```

## ğŸ” Security

- Uses Kubernetes RBAC with read-only access
- ServiceAccount with minimal required permissions
- Git credentials stored in Kubernetes Secrets

## ğŸ› ï¸ RBAC Permissions

The bot requires read access to:
- `nodes` (cluster-wide)
- `pods` (cluster-wide)
- `services` (cluster-wide)
- `ingresses` (cluster-wide)

## ğŸ“ License

MIT

## ğŸ‘¤ Author

Auto-generated by Claude Code for GMK Infrastructure
